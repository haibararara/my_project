#include "trap.h"
   .set noat
   .globl main
   .text
main:
   # 只测试 sw, lw, sb, lb 指令
   # 先设置栈指针为安全地址
   lui $sp, 0x8000           # $sp = 0x80000000 (.text段起始)
   ori $sp, $sp, 0x0F00      # $sp = 0x80000F00 (在.text段内，安全)
   
   # 初始化测试数据
   li $a1, 0x12345678        # 测试用的数据
   li $a3, 0x000000FF        # 字节测试数据
   li $t0, 0x80              # 负数测试数据
   
   # --------------------------------------------------
   # 测试 sw - 字存储
   # --------------------------------------------------
   sw $a1, 0($sp)            # 将 0x12345678 存入 0x80000F00
   
   # --------------------------------------------------
   # 测试 lw - 字加载  
   # --------------------------------------------------
   lw $t6, 0($sp)            # 从 0x80000F00 加载到 $t6
   bne $t6, $a1, fail        # 检查是否相等
   
   # --------------------------------------------------
   # 测试 sb - 字节存储
   # --------------------------------------------------
   sb $a3, 4($sp)            # 将 0xFF 存入 0x80000F04
   
   # --------------------------------------------------
   # 测试 lb - 字节加载（带符号扩展）
   # --------------------------------------------------
   lb $t7, 4($sp)            # 从 0x80000F04 加载字节
   li $s1, 0x000000FF        # 期望值
   bne $t7, $s1, fail        # 检查读取的值是否与写入的值相同
   
   # --------------------------------------------------
   # 测试带符号扩展的情况
   # --------------------------------------------------
   li $a3, 0x80              # 设置为负数 0x80 (-128)
   sb $a3, 8($sp)            # 存入 0x80000F08
   lb $t7, 8($sp)            # 加载，应该进行符号扩展
   li $s1, 0xFFFFFF80        # 符号扩展后应该是 0xFFFFFF80 (-128)
   bne $t7, $s1, fail
   
   # --------------------------------------------------
   # 所有测试通过
   # --------------------------------------------------
   HIT_GOOD_TRAP
   
fail:
   HIT_BAD_TRAP
